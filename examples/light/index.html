<body>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

    <span>
        <label for="red">Red</label>
        <input type="range" min="1" max="255" value="128" id="red" disabled>
    </span>
    <span>
        <label for="green">Green</label>
        <input type="range" min="1" max="255" value="128" id="green" disabled>
    </span>
    <span>
        <label for="blue">Blue</label>
        <input type="range" min="1" max="255" value="128" id="blue" disabled>
    </span>

    <script>
        const id = localStorage.getItem("id") || Math.random().toString(36).substring(7);
        localStorage.setItem("id", id);
        const topic = "color";
        const rgb = {
            red: 50,
            green: 50,
            blue: 50,
        }

        const client = mqtt.connect(
            "wss://mdd-mqtt:loislane@mdd-mqtt.cloud.shiftr.io",
            {
                clientId: id,
            }
        );

        client.on("connect", function () {
            console.log("connected!");
            const inputs = document.querySelectorAll("input");
            client.subscribe(topic + "/+");

            inputs.forEach((input) => {
                input.disabled = false;
                input.addEventListener("input", (e) => {
                    const value = e.target.value;
                    const color = e.target.id;
                    rgb[color] = value;
                    client.publish(topic + '/' + color, value);
                });
            });
        });

        client.on("message", function (topic, message) {
            console.log("message", topic, message.toString());
            const color = topic.split("/")[1];
            const input = document.getElementById(color);
            input.value = message.toString();
            const background = `rgb(${rgb.red}, ${rgb.green}, ${rgb.blue})`;
            console.log("background", background);
            document.body.style.backgroundColor = background;
        });
    </script>

    <style>
        body {
            display: flex;
            justify-content: center;
            gap: 2rem;
            align-items: center;
            flex-direction: column;
            height: 100vh;
        }

        label {
            display: none;
        }

        input#red {
            accent-color: red;
        }

        input#green {
            accent-color: green;
        }

        input#blue {
            accent-color: blue;
        }
    </style>
</body>
