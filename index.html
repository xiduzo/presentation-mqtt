<body>
  <script src="https://unpkg.com/mqtt/dist/mqtt.js"></script>
  <script>
    localStorage.debug = 'mqttjs*' // enables debugging
    const id = Math.random().toString(36).substring(7);
    const topic = "topic";
    const connection = "wss://mdd:loislane@37.97.203.138:8084"
    // const connection = "ws://mdd:loislane@37.97.203.138:8083" // Works
    // const connection = "wss://public:public@public.cloud.shiftr.io" // Works
    // const client = mqtt.connect(connection, {
    //   rejectUnauthorized: false,
    // });

    // let client = mqtt.connect(connection, {
    //   reconnectPeriod: 5000,
    //   // rejectUnauthorized: false,
    //   id,
    //   clientId: id,
    // });
    const broker = "37.97.203.138"
    const port = 8084
    const client_id = Math.random().toString(36).substring(7)
    const username = "username"
    const password = "password"
    const proto = "wss"
    var client = mqtt.connect({
      rejectUnauthorized: false,
      hostname: broker,
      port: port,
      clientId: client_id,
      username: username,
      password: password,
      protocol: proto,
      keepalive: 10,
    });

    client.stream.on('error', (error) => {
      console.log("Connection error", error);
      client.end()
    });

    client.on('connect', () => {
      client.subscribe(id, {
        qos: 2,
      });
    });

    client.on("message", messageReceived);
    client.on("connect", function () {
      println("connected!");
      client.subscribe("topic");
      client.publish("topic", "Hello from HTML");
    });
    client.on("error", function (error) {
      println("Error: " + error);
    });
    client.on('end', function () {
      println("Disconnected");
    })


    function messageReceived(topic, message) {
      println(topic + ": " + message);
    }
    function println(message) {
      const p = document.createElement("p");
      p.textContent = message;
      document.querySelector("body").append(p);
    }
  </script>
</body>